#include <stdio.h>
#include <stdlib.h>
#include <pthread.h>
#include <unistd.h>


unsigned long cpt = 0;
long int nb = 10000000;
pthread_mutexattr_t verrou = PTHREAD_MUTEX_INITIALIZER;

void compteur () {

    int i;
    int tmp;
    for ( i = 0; i < nb ; i++)
    {
        pthread_mutex_lock(&verrou);
        tmp = cpt;
        tmp++;
        cpt = tmp;
        pthread_mutex_unlock(&verrou);
    }

}

int main()
{
    pthread_t t1,t2;
    pthread_attr_t attr;

    pthread_attr_init(&attr);

    pthread_create(&t1, &attr, (void*)compteur , (void*)NULL);
    pthread_create(&t2, &attr, (void*)compteur , (void*)NULL);

    pthread_join(t1, NULL);
    pthread_join(t2, NULL);
    printf("Valeur finale compteur %lu\n", cpt);

    return 0;
}
