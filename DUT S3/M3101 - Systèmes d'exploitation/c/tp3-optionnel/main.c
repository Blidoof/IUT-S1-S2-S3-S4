#include <stdio.h>
#include <stdlib.h>
#include <pthread.h>
#include <unistd.h>
#define FALSE 0
#define TRUE 1

unsigned long cpt = 0;
long int nb = 100;

//Attributs liés à l'algo de Peterson

int veut_entrer1 = FALSE;
int veut_entrer2 = FALSE;
int tour;

void compteur1 ()
{
    int i;

    for ( i= 0; i < nb ; i++ )
    {
        veut_entrer1 = TRUE;
        tour = 1;

        while (veut_entrer2 && tour == 1)
        {

        }

        cpt++;

        veut_entrer1 = FALSE;
    }


}

void compteur2 ()
{

    int i;

    for ( i= 0; i < nb ; i++ )
    {

        veut_entrer2 = TRUE;

        tour = 0;

        while (veut_entrer1 && tour == 0)
        {

        }

        cpt++;

        veut_entrer2 = FALSE;
    }



}

int main()
{
    pthread_t t1,t2;
    pthread_attr_t attr;

    pthread_attr_init(&attr);

    pthread_create(&t1, &attr, (void*)compteur1 , (void*)NULL);
    pthread_create(&t2, &attr, (void*)compteur2 , (void*)NULL);

    pthread_join(t1, NULL);
    pthread_join(t2, NULL);
    printf("Valeur finale compteur %lu\n", cpt);

    return 0;
}
