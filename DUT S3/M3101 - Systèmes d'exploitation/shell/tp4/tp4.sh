#!/bin/bash

for ligne in `find -name "*.sh"` #récupération fichiers finissant par .sh
do
    if   ! head -n 1 $ligne | grep -q "#!/bin/bash" ; then #test si on trouve le sha bag
        sed -i '1s/^/#!\/bin\/bash\n/' $ligne #ajout du shabang

        #ajout dans log
        echo `date` >> log.txt
        echo "J'ai rajouté le sha-bang dans : $ligne" >> log.txt
    fi

    if [ ! -x $ligne ]; then

      #ajout des droits
      chmod +x $ligne

      #ajout dans log
      echo `date` >> log.txt
      echo "J'ai ajouté les droits d'execution sur : $ligne" >> log.txt
    fi
done
